Gpm-TI21x9s
https://www.youtube.com/watch?v=Gpm-TI21x9s
Unknown Category
Hey guys, so this is a balancing robot. And yes, yes, I know there are already a lot of balancing robots projects on the internet, but I wanted to make one for myself for a long time. And actually I wanted to make something special and make a mini balancing robot using this tiny PCB here. But I kind of failed with the stepper motors and I will explain that problem in the video, so stay tuned for that. So what I've done in the end is to use the same PCB that I've prepared for the mini balancing robot, design a small 3D printed body and use bigger stepper motors and like that be able to finish my idea. For now, this robot is pretty much stable even if you push it around. And I had a very hard time getting the good PID values so it would be more and more stable, but I'm not yet 100% happy with these results. Anyway, the robot should also get information from a homemade remote with a Bluetooth connection and like that we could move around. But internally, it should also get information from this IMU module here and calculate a PID value for the angle so it will never fall and always try to stay horizontal. That's pretty interesting and I think you will learn a lot with this video because I will explain step by step the circuit and also the code. So what do you think? Will this work? Stay tuned to find out. So guys, let's get started. These PCBs were manufactured by PCBWay and the finish quality is very good, especially with these gold plated pads. If you want to finish your product faster, you could also ask PCBWay to make a panelized order where you receive multiple PCBs on a single panel. Together with this, you can also order the SMD stencil from PCBWay and use it to add solder paste and solder all the components at once and by that you save time and effort. All the orders are high quality and you could select a lot of settings, such as the thickness, flexible PCBs, the color of the solder mask, the amount of layers, the material, the surface finish and more. So upload the Gerber files directly on PCBWay.com and make the order in just a couple of minutes. What's up my friends, welcome back. This here is the PCB that I've made for this project. And my plan was to use this PCB with this kind of stepper motors. I have this from some old DVD writers and I thought it would work great connected to this PCB. It's very easy to control them with some stepper drivers so that's not the problem. The problem was mechanical. You see these motors have the shaft connected to the magnets inside. This shaft is supported on both sides, here and here. So if I want to add a wheel to this shaft, I had to cut it smaller and in that way we have support only on one side. That's the problem. Without support on both sides, this shaft will move around and automatically break all the small coils and magnets inside. I've also tried gluing a bearing at the output but without success. Inside the shaft is kept in the center by a metal ball and once you move that, you can say goodbye to the whole motor. I've ordered these motors here which are smaller, but this time they are too small. They don't have enough torque and guess what? Their shaft is also weak and it will break very easy just as the other ones. So I had no other option but to use the NEMA 17 motors. These are one of the smaller NEMA 17 steppers. On the side of that PCB I've also designed this support. And like this we can attach the motors below. The battery in the middle and the PCB will be kept in place with some plastic supports. So this is not a mini robot anymore but anyway, let's make this robot and you will definitely learn something new. So let's see what we have on the PCB. If you want the same PCB, you can get the Gerber files from below and go to PCBway.com. You click the Code Now button and select your settings such as the thickness, the amount of PCBs, the materials and the solar mask color. In my case I've selected the black one but you can select any other one as for example purple or the matte black which look amazing. On the next page you can upload the Gerber files and order the PCBs. I've received my ports to Spain in around 8 days so let's check them out. On the front part we have some spaces for two stepper motor drivers. On the front part you can use the basic A4988 drivers or even better you can use the TMC2225 drivers for better and silent movement. Below that we have these 4 pins which are used to connect a buck converter for 5V. Because I want to use a 2S or maybe a 3S battery and because the digital part will work at 5V, I will connect a buck converter here to these pins and have that voltage. On the bottom side we have the output for the 2 stepper motors. This is the place where I wanted to solder those tiny motors but unfortunately they break too easy. If you manage to use them, just solder the motor and use a zip tie like this one and keep them in place. It would be a lot cooler to have a mini robot but anyway. What more do we have on the PCB? These 4 pins here are for the IMU module and I will use the MPU 6050 as always. We use this module to measure the angle. On the top part we have 4 more pins for the Bluetooth module and I will use the HC05. On side of that we have these 4 more pins for the I2C for an OLED display. I might add this as well so we can draw faces for the robot and give it more personality. I've also placed an SMD buzzer here for some notifications. On the bottom of the PCB we have some LEDs to make the robot look cooler and also the input from the battery. So now let's take a look on the back of the PCB. Actually the Bluetooth module will go here because the other side will be full of components. Below here we have the Atmega 328 microcontroller and the needed components in order to work. It's very difficult to see but we have 3 pairs of pads for each stepper driver and by soldering this here we can select the microstepping amount. That's it for the PCB, that's all we need. The PCB, the stepper drivers as well, the back converter module for 5V, the HC05 Bluetooth module, the NPU6050 sensor and two NEMA17 stepper motors. If you want you can also add an OLED screen like this one. As for the tiny components we need the buzzer, also some SMD capacitors, some LEDs and resistors and yet mega cheap together with the 60MHz resonator. As for the battery, you can use a 3S LiPo battery like this one. But in my case, because I have a lot of batteries from cell phones, I want to connect 2 of these iPhone batteries in series and get 12V. These are very flat and will occupy less space. As for the body, just download the STL files from below and print them using PLA material. I've used a 0.2 mm layer height and a 0.4 mm nozzle with 3 perimeters and 20% infill. As for the wheels, the inner part is made out of PLA but the exterior is made out of flexible material and this must be printed at very low speeds. Like that we can have more grip. The wheels have this hole so we can pass a screwdriver and tie the screw here. So we have to add a screw nut inside and then insert the shaft on the motor and tie the screw. And like that it will stay in place. Once we tie the screw, we can add this rubber part on top. So these are all the parts that we need for this robot, more or less. You have the full part list below on electronoops.com. So let's assemble it. It should end up something like this, like this 3D design example. So I get the main 3D printed part and add the stepper motors. You just have to apply a little bit of force and it will snap into place. Then we add some screws and washers and tie the motor. Also make sure that the motor connector is on the back side of the robot. Now get the plastic wheels and add a small nut inside of this hole. We also add a screw. Now we can add a wheel to each motor. We tie that screw so it will stay tight on the motor shaft. Now this part was printed in flexible filament. So we can now add this part on top of the wheels. First I wanted the battery to go here above the motors but you will see later that I will change the position. Now let's assemble the PCB so download this schematic from below and have it in front of you. I first solder these SMD capacitors. And then we add some female pins for the drivers so we can remove it when we want. Now I get one of these small buck converters and solder the 5V connection on the back. I also connect it to 12V and test if the output is around 5V. Now we can solder this on the PCB but we will do that later. Now solder that buzzer here on top and the LEDs on the bottom of the PCB. On the other side we can solder the Atmega microcontroller, the crystal resonator and the small resistors and capacitors. Now at this point I connect my FTDI programmer and test the connection to make sure it works. If the chip works, on the front side I solder the MPU6050. On the back I also add some female pins for the Bluetooth module. Now that the Atmega chip is in place and it works, I can now solder the buck converter on top so we can supply the PCB with the battery. I might also add the OLED screen later when everything works. So please check this full schematic below for all the connection if you are trying to make the same project. Also remember to solder together the pads for the MS2 on the back in order to enable the quarter micro stepping. At this point you can download the code from below and upload it to the PCB using the FTDI programmer connected to the wired port. Now we have to connect the PCB to the motors and the battery. For the battery I've soldered together in series three of these iPhone batteries. Like that I will have around 12V and I can also have a very thin battery. Now get this plastic printed leg and screw it on one arm of the PCB. Do the same with the other side but don't tie the screws yet. Now place the PCB over the main body and we glue in place these small plastic arms. Now we can tie the screws and the PCB will be fixed in place. So solder the wires from the stepper motors to the PCB on these pins here. Between the battery and the PCB I add a switch so we can turn the robot on and off. But guys, before we go over the code, I have to say that with this shape, this robot won't be stable. Why is that? Well, because this type of balancing robot will need some weight on the upper part in order to have some inertia. But at this moment all the weight is on the bottom side of the robot as you can see and is very difficult to balance. This robot will work exactly the same as trying to balance a stick in your hand. If the stick is too short, it will be impossible. When the stick is large enough, you can move your hand in the same direction as the tilt and you can stabilize it. That's why I've placed some threaded rods on top of the robot. On top I have a plywood part and here I can place the battery. Like this we can have more inertia when moving. This is a crucial part for this project. With the same code before, I now got better results but as you can see the robot is still wobbling around. That's because we can still have to adjust the PID values in the code. And this was the longest part of this project. I had to manually go and change the PID values till I got better and better but even so I am not quite happy with the final results. So for example, if you start only with the P values and the I and the D are zero, you get this kind of oscillations where the wheels are rotating in the same direction as the tilt of the robot according to the angle. But then we add some D values and this will react to the speed of changing of the angle and it will try to stop the oscillations. But that's not enough, especially when the error is very small. So finally, to fine adjust the position, we can add the I and that will increase and decrease slowly when the error is very small. So after more than 30 tries, I got more or less good results and the robot is quite stable but I am not entirely happy yet. So at this point I've decided to make a second part for this project where I will show you how to tune the PID values. So till then I will try to get better results and in that video I will explore the mathematics and physics behind this kind of project, including the IMU position, the center of gravity, the inertia of the robot, the motor speed and the PID algorithm. Before I end this video, let's take a look at the code. These here are the variables that you could change in order to tune the PID controller. This is the same that we had for the brushless PID controller or the ping pong ball controller but this time we use stepper motors. To create the step pulses applied to the stepper drivers, we use a timer, timer 2 in this case. So by setting these registers, we can make that timer to click every 20 microseconds. Next, with these lines here in the code, we read the raw data from the gyro and the accelerometer. To overcome the gyro offset, we make around 500 reads from the IMU module and we save this data as an offset and subtract that later in the main loop. Then we calculate the angle each loop, which is said to be around 4000 microseconds. Using this gyro angle variable, we can calculate the PID values. As always, we first find the PID error which is the difference between the real angle of the robot and the desired angle, which in this case should be zero so the robot will stay horizontal. Finally, inside of the timer routine, depending on the PID output, we calculate the speed of the motors by creating more or less, faster or slower pulses applied to the stepper motors. And to make the code faster, instead of using a digital write function, we use register control, where this line here for example is the same as setting the digital pin D3 to high. And for more about this, you can take a look at my Arduino register control video and the links are below. So using this code, the robot should be able to stay horizontal. When I lift the code, it will detect the angle and starts the PID code. When it detects a tilt on the front side, it will accelerate the wheels so it will get horizontal once again and do the same process backwards if the tilt is on the other side. If you do this fast enough with the PID control, you get a stable horizontal robot. So this is not yet perfect. I will make it better in the second part of this project. Without a remote, we can control it. I will also add that in the second part. I want to use this Wii console nunchuck and get the movement from this joystick and we can send the data using a Bluetooth module. This actually has an accuracy communication so I might use that to read the values from the joystick. The schematic would be something like this with the battery and also a switch, the Arduino, the joystick analog outputs and the Bluetooth module. Stay tuned for more. So guys, that's how a balanced robot works and how you can make one. You have my PCB below for download, you also have the schematic for the robot and controller, the part list and the codes and everything is below in the description. If you have learned something new, consider giving me a like or comment below. Thanks again and see you later guys. Hey, so one more video that ends, I hope that you like it. Okay, so listen, if you want to buy my merch, my t-shirts, you have the links below for my shop and I promise that I will make more designs. Also, maybe you would comment below which one you like more and what more designs you would like to see because in that way I could start designing them and post my new t-shirts. So thank you for all the support and I'll see you in the next video.