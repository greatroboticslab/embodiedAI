s0dNRe0XWJ8
https://www.youtube.com/watch?v=s0dNRe0XWJ8
Unknown Category
If you don't know who Chris Rosser is, get with the times. He is an aerospace engineer who is tearing up the world of FPV with his information on frame resonance analysis, PID tuning, frame design, just bringing an academic and professional engineering perspective to a field that all too often is made up of yahoos like me who just try things and see what works and talk about it. But he's an actual professional. And that's why I'm so excited today to be making this video. Because he has just released two videos. One on how to tune filters in Betaflight and then the other on the beginning of PID tuning, how to tune PD and feed forward. Chris's tutorials have really laid out PID tuning and filter tuning in a very simple and understandable way that I think that most everybody could follow. Well, many people could follow without necessarily having a deep, deep understanding of PID tuning and filtering. So what we're going to do today is we're going to go through those steps on my perfect freestyle build that I just finished building. And we're going to see if we can work out a PID tune. I'm Joshua Bardwell and you're going to learn something today. Before we dive into this video, you should know that some of the things Chris Rosser recommends that you do are explicitly disagreed with by, well, Kevin Plazier, the emu flight dev specifically spoke out against one of the decisions that Chris makes. And the other decisions Chris makes are different from the Betaflight defaults. And the reason the Betaflight defaults are the way that they are is that some people who don't use the defaults will have flyaways or smoked motors. So don't just dive in and follow these steps. This is not a safe for everyone PID tuning process. You need to pay attention to the gotchas and caveats. And if you do not meet all the qualifications of step one, do not proceed to step two, three, four, five, six, seven, go back and stop and get step one right. This is a really aggressive tune at the end and your quad will fly amazing if it can handle it. Enough said. When the oneiden is working, when the mosquitoes work together are very beautiful, I don't know how toень effect the heights of the most ratherigiousarius. Interesting to help one is the Ter towards Bernardino, that means this isn't something that is natural for you. And with his ProfIO, Whoooa! Whoooa! Whoa! Whoooa! Whoooo! Whoooa! Whoooa! Whoooa! Whooooa! Whooa! Whoooa! Whoooa! That's a pretty good PID tune. Let's see how I got there. The very first thing Chris tells you to do in his filter tuning video, and this is the beginning of every PID tune, is to make sure your aircraft is mechanically sound. So often people reach out to me asking for a PID tuning solution to a mechanical issue. And I like to say it's like trying to hike on a sprained ankle. You could get some crutches and you could sort of limp along, but the real thing to do is to heal up your sprained ankle and then come at it from a healthy perspective. And if your quadcopter is not mechanically sound, then you can't really start PID tuning effectively or you're going to be PID tuning around the problem and it's going to really hold you back. Now Chris has some suggestions for specific things that you want to check because when I say mechanically sound, what does that even mean? So you definitely want to check these things. These are, this is a really, really excellent summary of like the top five or six things that need to be right about your frame. The only thing I would add to this is you want to check your frame for cracks. Like if you have an arm that's beginning to delaminate or a bottom plate that's beginning to crack, this could be very easy to overlook. But when you start trying to PID tune, it can make a problem that can't be solved. And you just got to kind of just look at it and make sure you don't have any cracks or anything. The next thing Chris advises is to fly the quad on default PIDs and log. And that's what we've got here. But before we do that, let's talk about the quad itself. You're going to want to fly your quad in the same setup, in the same situation as it'll be flown in real life. So if you're going to be flying in real life with a GoPro on, you're going to want to tune with a GoPro on. If you're going to be flying in real life with a 1300 milliamp hour pack, you're going to want to tune with a 1300 milliamp hour pack. Every tune will have a little bit of flexibility. Like taking the GoPro, unless you tune to the absolute edge of performance, you'll be able to fly the quad with a GoPro on or off or switch between a 1000 milliamp hour and a 1250 milliamp hour pack without making too many changes in the tune. But the further you push the tune toward that nth degree of perfection, the less flexibility you'll have to change things about the quad. So you may want, after you get a good tune, you may want to test it out with different batteries or with or without the GoPro. The one thing I am going to point out to you though is you can see I am not flying brand new props. And I would recommend, unless you are going to be 100% scrupulous about flying on brand new props every time, if you ever feel like you might need to turtle mode and come home on a broken or a bent prop, fly with some beat up props. Do your tuning that way. And that way you will build in just a little bit of headroom. Your quad will just fly that much better when you have clean props, new props. But if you ever do break a prop or bend a prop, you won't immediately smoke a motor. So let's put the quad up in the air and do our first test flight. And Chris's video has instructions for how to set up your black box logging and for how to get the black box logs off the quad and import them into black box viewer. So link in the video description to Chris's video if you need instructions for how to do that. As we do the tuning flight, we're going to make sure that it includes a lot of full stick 360 rolls, full stick 360 flips and yaw spins, as well as some gradual ramps from zero to full throttle. And we're going to want to make those ramps smooth and gradual so any resonance in the frame gets a good chance to come out. We're not just going to do full throttle punches and we're going to want to hold at full throttle and ramp back down. Now at this point, if your motors don't sound completely smooth on the stock beta flight defaults. Oh, that's what we're flying on, the stock beta flight defaults. 1.0 on all the filter sliders, 1.0 on all the pin sliders. If anything doesn't sound completely smooth, if you have any signs of vibration or gyro problems, go back to step one, you have a mechanical issue. At least for 5 inch mini quads and smaller. If you're flying like a 7 inch or a 10 inch or a 13 inch frame, the default filtering from beta flight may not be right for you and you may need to tweak it, but that's a topic for another video. So let's open up this black box log in black box viewer and we're using Mark Spatz's presets for these different views, all these different views here. They can be downloaded from theuavtech.com. I'll put a link to that down in the video description, as well as if you need to know how to download and open them, I'll link to a video that shows how to do that. But what we want to see is the gyro scaled. And we're going to click there. And that brings up this. We're going to just go ahead and expand that. And we're going to change from frequency to frequency versus throttle. And this graph looks really freaking good. Let's just turn that up a little bit so we can see it a little better. We have a small amount of resonance around 200 hertz. Nothing too extreme. A little bit of resonance here, lower than that. But on roll, there's nothing crazy that jumps out. On pitch, we can see a little more resonance. But nothing too bad. Nothing higher than about 200 hertz. And on yaw, again, just a little bit of resonance at 200 hertz and the normal amount of motor noise. Based on the fact that my black box log looks pretty clean, and Chris actually looked at a black box log of a previous flight that I did, which had similar characteristics to this. Chris made some filter recommendations that were more or less the same as his suggestions here for clean builds. So we're going to go ahead and implement these filter suggestions as shown here, and then we'll move on. We'll go to the PID tuning tab. We'll go to Filter Settings. Chris says to turn off the gyro low-pass filters because if you're doing RPM filtering and dynamic filtering, you probably can get away with not having any gyro filtering. They will do a sufficient job. Chris suggests 0, 250, 100, and 400 for the dynamic notch filter. And he suggests a single static bi-quad filter at 100 hertz to help clean up the D-turn. And we'll go ahead and save that. But the next thing Chris has to do is to find your maximum D gain. And this is a really great way to approach PID tuning. A lot of times people used to approach PID tuning by finding the P gain first and then tuning D as best they could. But mechanical filters, D gain, then P actually makes a lot more sense because you want your D gains to be as high as they need to be. You'll always get a better flying quad with high D gains up to the point where you'll start to get flyaways or smoke motors. So you want to push your D gains as high as they can be while still having acceptably cool motors and acceptably low risk of flyaway and then find the P balance that works best for you there. And that'll probably give you a good flying quad. As Chris said, the more D gain you have, the hotter your motors will get, the more likely you are to get oscillations, especially if you've been to prop. So it is really a question of your tolerance as to how much risk you're willing to get. A lot of racers will fly ultra-high D gains. The quad is practically on the limit of smoking a motor at all times, but they have a really, really sharp flying quad. For a typical freestyle or a casual pilot, you may want to give up just a little bit of that flight feel and performance for less risk of damaging your equipment. Chris gives a range of recommended D gains for people flying a 5-inch freestyle from stock of around 30, which is really conservative, up to 45+, which has a much higher risk of smoking motors. I will say, these are fine guidelines, but even these may be a little conservative. I've had, like, I've personally played around with PID tuning on this build and had D gains at 50 or 55+, without really seeming to have much sign of smoked motors, but everybody's build is going to be different. But before we start doing our test flights, we're going to go in and make this change in the CLI. And I'm not really sure why Betaflight does this. Betaflight, by default, limits the PID controller to 40% of its maximum authority. And if it exceeds that, then, well, it's not allowed to exceed that. So, we're going to set PID sum limit equals 1,000, which is 100%. There's probably a good reason why Betaflight has you do this. I'm sure they didn't just do it for no reason. So, maybe something bad will happen to some people if they make this change. But if you're trying to get a really good PID tune, this is definitely something you should start with. And then what we're going to do is we're going to go out and fly and we're just going to try to make the motors as hot as possible by doing sharp turns, by doing full throttle punches, and we're going to listen for signs of runaway, signs of warbling, oscillation, unsmooth motors, or we're going to feel for hot motors at the end of each flight. And we're going to turn up the master multiplier gradually, 0.1 to 0.2 at a time, and try to find the point where that starts to happen, then back off. And I'm going to do something in the interest of time. Normally, what Chris suggests is to raise the master in little increments of 0.1 or 0.2. I'm going to make a bigger jump, and then if I overshoot, I'm going to work my way back. I don't necessarily suggest you do that. I'm going to be a little careful here, because if I have gone too far, the quad could want to fly away or something dumb like that. Motors aren't complaining. I don't hear any signs of them complaining. Little hitch there. Little hitches there. You see those little hitches? Yeah, so that's too far. Sorry, my mom's going. All right, so we had little hitches there. Motors still aren't super hot, but that's too far. Let's try dialing that back down a little bit. Here on PID tuning. We're just going to knock that down. Oh, I need to disable D-Man. I forgot to do that. I don't think that... Yeah, I need to disable D-Man. I forgot that step. That's also stuff. We're going to take that down to 1.4, and we're going to see how we do. Let's see if 1.4 clears that up. Also, we've disabled D-Man, which I should have done first. Tiny little hitch there. Littlest of hitches if I do extended full throttle punches. I feel like this is a good place for me to be, though. Remember, we are a little bit on bed props, so on clean props, fresh props, that probably would go away. But I feel like if I just do normal flying, none of that will come out. No, see? No. See? Already... I feel like we're flying really good. Even just tuning that master slider has made a big freaking difference. I mean, so often when I fly, I just fly on the defaults. I'm like, whatever. I just want to get in the air. Just freaking turning this up has made such a big difference. It's still pretty smooth. Like, you can see that there's no hitches here. Even if I do a big punch, it's only if I do a really extreme punch that I start to see those little blips. So I feel like this is a good place to be. Oh, yeah. So next, we'll start to dial in our V-game. Oh. So good. That's so good. Damn, son. That's so good. Whew. That quad's flying real good, ain't it, folks? Oh, man. Boy, I bet you can't wait to see the rest of this process. Whew. Yeah. It's going to be a multi-parter. This is part one. I'm going to upload the rest of it to the channel over the subsequent days. Don't worry. It's all shot. It's all done. I just got to finish editing it. But I wanted to give you part one today just to get it out. There will be links down in the video description to part two and if there's, I think it's going to be two or maybe three parts. But there will be links down below. Or, hey, you know, you could get subscribed and hit that notification bell if you wanted to be sure to not miss it. I mean, you know, it's up to you. Yeah. See you tomorrow.